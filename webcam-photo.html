<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta charset="utf-8">
    	<meta http-equiv="X-UA-Compatible" content="IE=edge">
    	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="description" content="">
	<meta name="author" content="Dru (www.lladruc.net)">
	<link rel="icon" type="image/png" href="https://sas.lladruc.net/@img/webicon.png">
	<meta name="robots" content="noindex">
	<meta name="googlebot" content="noindex">
	<title>
	</title>
	<style>
		.video-wrap{
			text-align:center;
		}
		.controller{
			text-align:center;
		}
		#canvas{
			visibility:hidden;
		}
	</style>
</head>
<body>
	<!—Aquí el video embebido de la webcam -->
	<div class="video-wrap">
	<video id="video" playsinline autoplay></video>
	</div>
	<!—El elemento canvas -->
	<div class="controller">
	<button id="snap">Capture</button>
	<a id="download" download="Canvas.png">Download Canvas</a>

	</div>
	<!—Botón de captura -->
	<canvas id="canvas" width="640" height="480"></canvas> 


<script type="text/javascript">
	'use strict';
	const video = document.getElementById('video');
	const snap = document.getElementById("snap");
	const canvas = document.getElementById('canvas');
	const errorMsgElement = document.querySelector('span#errorMsg');
	const constraints = {
	audio: true,
	video: {
	width: 800, height: 600
	}
	};
	// Acceso a la webcam
	async function init() {
	try {
	const stream = await navigator.mediaDevices.getUserMedia(constraints);
	handleSuccess(stream);
	} catch (e) {
	errorMsgElement.innerHTML = `navigator.getUserMedia error:${e.toString()}`;
	}
	}
	// Correcto!
	function handleSuccess(stream) {
	window.stream = stream;
	video.srcObject = stream;
	}
	// Load init
	init();
	// Dibuja la imagen
	var context = canvas.getContext('2d');
	snap.addEventListener("click", function() {
	context.drawImage(video, 0, 0, 640, 480);
	});

	//var canvas = document.getElementById("canvas");
	function downloadCanvas() {
	var data = canvas.toDataURL('image/png');
	/* Change MIME type to trick the browser to downlaod the file instead of displaying it */
	data = data.replace(/^data:image\/[^;]*/, 'data:application/octet-stream');
	 
	/* In addition to <a>'s "download" attribute, you can define HTTP-style headers */
	data = data.replace(/^data:application\/octet-stream/, 'data:application/octet-stream;headers=Content-Disposition%3A%20attachment%3B%20filename=Canvas.png');
	 
	this.href = data;
	};
	document.getElementById("download").addEventListener('click', downloadCanvas, false);

</script>
</body>
</html>
